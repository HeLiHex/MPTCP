name: Build
on:
  push:
    branches:
      - master
  pull_request:
    types: [opened, synchronize, reopened]
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      - name: Set up JDK 11
        uses: actions/setup-java@v1
        with:
          java-version: 11
      - name: Cache SonarCloud packages
        uses: actions/cache@v1
        with:
          path: ~/.sonar/cache
          key: ${{ runner.os }}-sonar
          restore-keys: ${{ runner.os }}-sonar
      - name: Cache Maven packages
        uses: actions/cache@v1
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: ${{ runner.os }}-m2
      - name: Build and analyze
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information, if any
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        run: mvn -B verify org.sonarsource.scanner.maven:sonar-maven-plugin:sonar

      - name: ReportGenerator
        # You may pin to the exact commit or the version.
        # uses: danielpalme/ReportGenerator-GitHub-Action@20ddd3f99fb61036ab0acef267268af074419b1f
        uses: danielpalme/ReportGenerator-GitHub-Action@4.6.7
        #with:
          # The coverage reports that should be parsed (separated by semicolon). Globbing is supported.
          # reports: # default is coverage.xml
          # The directory where the generated report should be saved.
          # targetdir: # default is coveragereport
          # The output formats and scope (separated by semicolon) Values: Badges, Clover, Cobertura, CsvSummary, Html, HtmlChart, HtmlInline, HtmlInline_AzurePipelines, HtmlInline_AzurePipelines_Dark, HtmlSummary, JsonSummary, Latex, LatexSummary, lcov, MHtml, PngChart, SonarQube, TeamCitySummary, TextSummary, Xml, XmlSummary
          # reporttypes: # optional, default is HtmlInline;Cobertura
          # Optional directories which contain the corresponding source code (separated by semicolon). The source directories are used if coverage report contains classes without path information.
          # sourcedirs: # optional, default is 
          # Optional directory for storing persistent coverage information. Can be used in future reports to show coverage evolution.
          # historydir: # optional, default is 
          # Optional plugin files for custom reports or custom history storage (separated by semicolon).
          # plugins: # optional, default is 
          # Optional list of assemblies that should be included or excluded in the report. Exclusion filters take precedence over inclusion filters. Wildcards are allowed.
          # assemblyfilters: # optional, default is +*
          # Optional list of classes that should be included or excluded in the report. Exclusion filters take precedence over inclusion filters. Wildcards are allowed.
          # classfilters: # optional, default is +*
          # Optional list of files that should be included or excluded in the report. Exclusion filters take precedence over inclusion filters. Wildcards are allowed.
          # filefilters: # optional, default is +*
          # The verbosity level of the log messages. Values: Verbose, Info, Warning, Error, Off
          # verbosity: # optional, default is Info
          # Optional tag or build version.
          # tag: # optional, default is ${{ github.run_number }}_${{ github.run_id }}
          # Optional custom settings (separated by semicolon). See: https://github.com/danielpalme/ReportGenerator/wiki/Settings
          # customSettings: # optional, default is 
